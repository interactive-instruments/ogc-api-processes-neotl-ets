import "Actions.neotl"
import "../../shared/Assertions.neotl"

TestCase "Validate OpenAPI Landing Page" {
    // conf/core/landingpage-op
    id: core1LandingTc1
    description: "Check if the returned document meets the requirements for JSON."
    references:
        - "API landing page"
            "https://docs.ogc.org/DRAFTS/18-062.html#req_core_landingpage-op"
            AbstractTestCase

    ValidationStep "Request the Landing Page as JSON document" {
        
        // generate id in snippted based on TC id 
        id: core.landing.tc1.step
        description: "Request an JSON document with an Accept application/json header"

        given:

        when: Request requestsLandingJson executed

        then:
            - Assert OpenAPI3 { 
                schema "${schemaUrl}/landingPage.yaml"
                validates
            }
            - AssertionGroup responseJsonReceived must pass 
    }
}

TestCase "Validate OpenAPI HTML Landing Page" {
    // /conf/core/landingpage-success
    id: core1LandingTc2
    description: "Check if the returned document meets the requirements for HTML."
    references:
        - "API landing page"
            "https://docs.ogc.org/DRAFTS/18-062.html#req_core_landingpage-op"
            AbstractTestCase

    ValidationStep "Request the Landing Page as HTML document" {
        id: core.landing.tc2.step
        description: "Request an HTML document with an Accept text/html header"

        given:
            - ConformanceClass http://www.opengis.net/spec/ogcapi-processes-1/1.0/conf/html

        when: Request requestsLandingHtml executed

        then:
            - AssertionGroup responseHtmlReceived must pass
            - Assert HTML is valid
            - Assert Manual {
                "Validate that the landing page includes a 'service-desc' and/or 'service-desc' link to an API Definition."
                "Validate that the landing page includes a 'http://www.opengis.net/def/rel/ogc/1.0/conformance' link to the conformance class declaration."
                "Validate that the landing page includes a 'processes' link to the list of processes."
            }
    }
}